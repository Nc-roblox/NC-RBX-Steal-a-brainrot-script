-- Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Player = Players.LocalPlayer

-- Daily key URL (raw GitHub file)
local keyUrl = "https://raw.githubusercontent.com/Nc-roblox/Daily-Key-Page/refs/heads/main/dailykey.txt"

-- Function to fetch today's key (cleaned)
local function getTodayKey()
    local success, result = pcall(function()
        return game:HttpGet(keyUrl)
    end)
    if success and result then
        -- remove carriage returns/newlines and surrounding whitespace
        local key = result:gsub("\r",""):gsub("\n",""):gsub("^%s+",""):gsub("%s+$","")
        return key
    else
        warn("Could not fetch key")
        return nil
    end
end

-- ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = Player:WaitForChild("PlayerGui")
ScreenGui.Name = "NC_RBX_GUI"

-- ===== Loading Screen =====
local LoadingFrame = Instance.new("Frame")
LoadingFrame.Size = UDim2.new(0, 400, 0, 100)
LoadingFrame.Position = UDim2.new(0.5, -200, 0.5, -50)
LoadingFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
LoadingFrame.BorderSizePixel = 0
LoadingFrame.Parent = ScreenGui

local LoadingText = Instance.new("TextLabel")
LoadingText.Size = UDim2.new(1,0,0,40)
LoadingText.Position = UDim2.new(0,0,0,10)
LoadingText.BackgroundTransparency = 1
LoadingText.Text = "Loading..."
LoadingText.TextColor3 = Color3.fromRGB(0,170,255)
LoadingText.Font = Enum.Font.GothamBold
LoadingText.TextScaled = true
LoadingText.Parent = LoadingFrame

local LoadingBarBack = Instance.new("Frame")
LoadingBarBack.Size = UDim2.new(0.8,0,0,20)
LoadingBarBack.Position = UDim2.new(0.1,0,0,60)
LoadingBarBack.BackgroundColor3 = Color3.fromRGB(50,50,50)
LoadingBarBack.BorderSizePixel = 0
LoadingBarBack.Parent = LoadingFrame

local LoadingBar = Instance.new("Frame")
LoadingBar.Size = UDim2.new(0,0,1,0)
LoadingBar.Position = UDim2.new(0,0,0,0)
LoadingBar.BackgroundColor3 = Color3.fromRGB(0,170,255)
LoadingBar.BorderSizePixel = 0
LoadingBar.Parent = LoadingBarBack

local tween = TweenService:Create(LoadingBar, TweenInfo.new(3, Enum.EasingStyle.Linear), {Size = UDim2.new(1,0,1,0)})
tween:Play()
tween.Completed:Connect(function()
    LoadingFrame:Destroy()
    CreateKeyPrompt()
end)

-- ===== Key Prompt (with two Get Key buttons) =====
function CreateKeyPrompt()
    local KeyFrame = Instance.new("Frame")
    KeyFrame.Size = UDim2.new(0,450,0,250) -- slightly bigger
    KeyFrame.Position = UDim2.new(0.5,-225,0.5,-125)
    KeyFrame.BackgroundColor3 = Color3.fromRGB(20,20,20)
    KeyFrame.BorderSizePixel = 0
    KeyFrame.Parent = ScreenGui
    KeyFrame.ZIndex = 50

    local KeyTitle = Instance.new("TextLabel")
    KeyTitle.Size = UDim2.new(1,-16,0,28)
    KeyTitle.Position = UDim2.new(0,8,0,6)
    KeyTitle.BackgroundTransparency = 1
    KeyTitle.Text = "Enter today's key"
    KeyTitle.TextColor3 = Color3.fromRGB(255,255,255)
    KeyTitle.Font = Enum.Font.GothamBold
    KeyTitle.TextSize = 20
    KeyTitle.TextXAlignment = Enum.TextXAlignment.Left
    KeyTitle.ZIndex = 51
    KeyTitle.Parent = KeyFrame

    local KeyInfo = Instance.new("TextLabel")
    KeyInfo.Size = UDim2.new(1,-16,0,18)
    KeyInfo.Position = UDim2.new(0,8,0,36)
    KeyInfo.BackgroundTransparency = 1
    KeyInfo.Text = "Click a provider, complete the step, then paste the daily key below."
    KeyInfo.TextColor3 = Color3.fromRGB(180,180,180)
    KeyInfo.Font = Enum.Font.SourceSans
    KeyInfo.TextSize = 14
    KeyInfo.TextXAlignment = Enum.TextXAlignment.Left
    KeyInfo.ZIndex = 51
    KeyInfo.Parent = KeyFrame

    local KeyBox = Instance.new("TextBox")
    KeyBox.Size = UDim2.new(1,-16,0,44)
    KeyBox.Position = UDim2.new(0,8,0,60)
    KeyBox.BackgroundColor3 = Color3.fromRGB(30,30,30)
    KeyBox.TextColor3 = Color3.fromRGB(255,255,255)
    KeyBox.Font = Enum.Font.GothamBold
    KeyBox.TextSize = 18
    KeyBox.ClearTextOnFocus = false
    KeyBox.PlaceholderText = "Paste key here"
    KeyBox.ZIndex = 52
    KeyBox.Parent = KeyFrame

    -- Buttons container
    local ButtonsHolder = Instance.new("Frame")
    ButtonsHolder.Size = UDim2.new(1,-16,0,52)
    ButtonsHolder.Position = UDim2.new(0,8,0,112)
    ButtonsHolder.BackgroundTransparency = 1
    ButtonsHolder.ZIndex = 52
    ButtonsHolder.Parent = KeyFrame

    local LINKVERTISE_URL = "https://link-target.net/1235059/NSQWIsqepdlm"
    local LOOTLABS_URL = "https://loot-link.com/s?gxrkLwa4"

    local function makeButton(text, posX, url)
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(0.48,-6,1,0)
        btn.Position = UDim2.new(posX,0,0,0)
        btn.BackgroundColor3 = Color3.fromRGB(10,130,220)
        btn.Font = Enum.Font.GothamBold
        btn.TextSize = 16
        btn.TextColor3 = Color3.fromRGB(255,255,255)
        btn.Text = text
        btn.ZIndex = 53
        btn.Parent = ButtonsHolder
        btn.MouseButton1Click:Connect(function()
            if setclipboard then
                pcall(setclipboard, url)
                KeyInfo.Text = text.." link copied to clipboard."
            else
                KeyInfo.Text = "Clipboard not available; link printed to console."
            end
            print("[KEY GUI] Copied link for " .. text .. ":", url)
        end)
    end

    makeButton("Get Key (Linkvertise)", 0, LINKVERTISE_URL)
    makeButton("Get Key (LootLabs)", 0.52, LOOTLABS_URL)

    local StatusLabel = Instance.new("TextLabel")
    StatusLabel.Size = UDim2.new(1,-16,0,18)
    StatusLabel.Position = UDim2.new(0,8,0,172)
    StatusLabel.BackgroundTransparency = 1
    StatusLabel.Text = ""
    StatusLabel.TextColor3 = Color3.fromRGB(255,200,0)
    StatusLabel.Font = Enum.Font.SourceSans
    StatusLabel.TextSize = 14
    StatusLabel.TextXAlignment = Enum.TextXAlignment.Left
    StatusLabel.ZIndex = 52
    StatusLabel.Parent = KeyFrame

    local ConfirmButton = Instance.new("TextButton")
    ConfirmButton.Size = UDim2.new(0.46,0,0,36)
    ConfirmButton.Position = UDim2.new(0.27,0,0,188)
    ConfirmButton.BackgroundColor3 = Color3.fromRGB(0,170,255)
    ConfirmButton.Text = "Confirm & Run"
    ConfirmButton.Font = Enum.Font.GothamBold
    ConfirmButton.TextColor3 = Color3.fromRGB(255,255,255)
    ConfirmButton.TextSize = 18
    ConfirmButton.ZIndex = 53
    ConfirmButton.Parent = KeyFrame

    ConfirmButton.MouseButton1Click:Connect(function()
        StatusLabel.Text = "Verifying key..."
        spawn(function()
            local todayKey = getTodayKey()
            if todayKey and KeyBox.Text and KeyBox.Text:gsub("%s+","") == todayKey then
                StatusLabel.Text = "Key valid â€” launching."
                KeyFrame:Destroy()
                CreateConsole()
            else
                StatusLabel.Text = "Invalid key. Copy a provider link above and try again."
                KeyInfo.Text = "Tip: paste the key exactly as shown (no extra spaces)."
                KeyInfo.TextColor3 = Color3.fromRGB(255,140,140)
            end
        end)
    end)
end


-- ===== Console Creation Function =====
function CreateConsole()
    local Frame = Instance.new("Frame")
    Frame.Size = UDim2.new(0, 420, 0, 320)
    Frame.Position = UDim2.new(0.3,0,0.25,0)
    Frame.BackgroundColor3 = Color3.fromRGB(20,20,20)
    Frame.BorderSizePixel = 0
    Frame.Parent = ScreenGui
    Frame.ZIndex = 5

    -- Title
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1,0,0,34)
    Title.Position = UDim2.new(0,0,0,0)
    Title.BackgroundColor3 = Color3.fromRGB(0,170,255)
    Title.Text = "NC RBX - Key valid for 24h"
    Title.TextColor3 = Color3.fromRGB(255,255,255)
    Title.Font = Enum.Font.GothamBold
    Title.TextScaled = true
    Title.Parent = Frame
    Title.ZIndex = 6

    -- Minimize / Maximize Button
    local MinButton = Instance.new("TextButton")
    MinButton.Size = UDim2.new(0,30,0,30)
    MinButton.Position = UDim2.new(1,-36,0,2)
    MinButton.BackgroundColor3 = Color3.fromRGB(255,100,100)
    MinButton.Text = "-"
    MinButton.Font = Enum.Font.GothamBold
    MinButton.TextColor3 = Color3.fromRGB(255,255,255)
    MinButton.TextScaled = true
    MinButton.Parent = Frame
    MinButton.ZIndex = 7

    local Minimized = false
    local SavedSize = Frame.Size

    MinButton.MouseButton1Click:Connect(function()
        if not Minimized then
            SavedSize = Frame.Size
            Frame.Size = UDim2.new(0,180,0,44)
            for _,child in pairs(Frame:GetChildren()) do
                if child ~= Title and child ~= MinButton then
                    child.Visible = false
                end
            end
            MinButton.Text = "+"
            Minimized = true
        else
            Frame.Size = SavedSize
            for _,child in pairs(Frame:GetChildren()) do
                child.Visible = true
            end
            MinButton.Text = "-"
            Minimized = false
        end
    end)

    -- Infinite Jump Toggle
    local ToggleButton = Instance.new("TextButton")
    ToggleButton.Size = UDim2.new(0,150,0,44)
    ToggleButton.Position = UDim2.new(0.06,0,0,56)
    ToggleButton.Text = "INFINITE JUMP: OFF"
    ToggleButton.TextColor3 = Color3.fromRGB(255,255,255)
    ToggleButton.BackgroundColor3 = Color3.fromRGB(200,0,0)
    ToggleButton.Font = Enum.Font.GothamBold
    ToggleButton.TextSize = 16
    ToggleButton.Parent = Frame
    ToggleButton.ZIndex = 6

    local InfiniteJumpEnabled = false
    ToggleButton.MouseButton1Click:Connect(function()
        InfiniteJumpEnabled = not InfiniteJumpEnabled
        if InfiniteJumpEnabled then
            ToggleButton.Text = "INFINITE JUMP: ON"
            ToggleButton.BackgroundColor3 = Color3.fromRGB(0,160,0)
        else
            ToggleButton.Text = "INFINITE JUMP: OFF"
            ToggleButton.BackgroundColor3 = Color3.fromRGB(200,0,0)
        end
    end)

    -- Boost Multiplier Label
    local MultiLabel = Instance.new("TextLabel")
    MultiLabel.Size = UDim2.new(0.9,0,0,22)
    MultiLabel.Position = UDim2.new(0.05,0,0,116)
    MultiLabel.BackgroundTransparency = 1
    MultiLabel.Text = "Boost Multiplier"
    MultiLabel.TextColor3 = Color3.fromRGB(0,170,255)
    MultiLabel.Font = Enum.Font.GothamBold
    MultiLabel.TextSize = 18
    MultiLabel.Parent = Frame
    MultiLabel.ZIndex = 6

    -- Multiplier Buttons
    local multipliers = {0.8,1,1.2,1.5,1.7,2}
    local ButtonsContainer = Instance.new("Frame")
    ButtonsContainer.Size = UDim2.new(0.9,0,0,120)
    ButtonsContainer.Position = UDim2.new(0.05,0,0,148)
    ButtonsContainer.BackgroundTransparency = 1
    ButtonsContainer.Parent = Frame
    ButtonsContainer.ZIndex = 6

    local JumpPowerMultiplier = 1
    for i, mult in ipairs(multipliers) do
        local Btn = Instance.new("TextButton")
        Btn.Size = UDim2.new(0,120,0,40)
        local row = math.floor((i-1)/3)
        local col = (i-1)%3
        Btn.Position = UDim2.new(0, col * 132, 0, row * 44)
        Btn.Text = tostring(mult) .. "x"
        Btn.TextColor3 = Color3.fromRGB(255,255,255)
        Btn.BackgroundColor3 = Color3.fromRGB(0,0,180)
        Btn.Font = Enum.Font.GothamBold
        Btn.TextSize = 18
        Btn.Parent = ButtonsContainer
        Btn.ZIndex = 6

        Btn.MouseButton1Click:Connect(function()
            JumpPowerMultiplier = mult
        end)
    end

    -- Dragging logic
    local dragging, dragInput, dragStart, startPos
    local function update(input)
        local delta = input.Position - dragStart
        Frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X,
                                   startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end

    Frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = Frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    Frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if dragging and input == dragInput then
            update(input)
        end
    end)

    -- Infinite Jump logic
    local jumpDelay = 0.18
    local lastJumpTime = 0

    local function SetupCharacter(Char)
        local Humanoid = Char:WaitForChild("Humanoid")
        local RootPart = Char:WaitForChild("HumanoidRootPart")

        UserInputService.JumpRequest:Connect(function()
            if InfiniteJumpEnabled then
                local now = tick()
                if now - lastJumpTime >= jumpDelay then
                    RootPart.Velocity = Vector3.new(RootPart.Velocity.X, Humanoid.JumpPower * JumpPowerMultiplier, RootPart.Velocity.Z)
                    lastJumpTime = now
                end
            end
        end)
    end

    if Player.Character then
        SetupCharacter(Player.Character)
    end
    Player.CharacterAdded:Connect(SetupCharacter)
end
